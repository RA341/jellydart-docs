# Auth with metadata

The current auto-generated auth class dont add the auth header properly 
so we added the [auth_metadata.dart](../jellydart/lib/auth_with_metadata.dart) 

## The proper auth scheme

Taken from - [jellyfin docs]()

The Authorization header uses the format Authorization: <scheme> <parameters>. 
The Jellyfin scheme is named MediaBrowser and it uses named values separated by commas. 
There is no specific order for parameters. All keys are case sensitive and only allow alphanumeric characters. Unknown keys are ignored by the server. Values must be wrapped in double quotes (") and should use url encoding.

MediaBrowser key="value", key2="value2", key3="value3"

Parameters
Key 	Description
Token 	The access token or API key
Client 	The name of the client
Version 	The version of the client
DeviceId 	A unique id for the device generated by the client
Device 	The device name

The token parameter is required to use authenticated endpoints. The client and version properties are used to identify the client in the dashboard.

### Note about Device identifiers:

When it comes to device identifiers in the Jellyfin API, 
it's important to understand the nuances involved. While generating a random string for the deviceId might seem like a straightforward solution, there are certain limitations to consider. Currently, the server permits only a single access token for each deviceId. This means that you cannot have multiple users signed into your client with a single randomized string. To work around this limitation, you'll need to use a unique identifier for each combination of a device-specific identifier and user-specific identifier.

Since it's often not possible to know the user identifier before signing in at least once, we recommend including the username as user-specific identifier. It is advisable to hash the username because it is user-input that could include double quotes (escaping the header value format) or special characters that your HTTP library might not allow.
Examples

Here are a couple of examples for the authorization header:

Authenticate with API key
```
Authorization: MediaBrowser Token="8ac3a7abaff943ba9adea7f8754da7f8"
```

Authenticate with access token
```
Authorization: MediaBrowser Token="0381cf931f9e42d79fb9c89f729167df", Client="Android TV", Device="Nvidia Shield", DeviceId="ZQ9YQHHrUzk24vV", Version="0.15.3"
```

The ApiKey query parameter
Use the ApiKey query parameter when the Authorization header can't be used. The value of the query parameter is the access token or API key. Avoid using this option if possible. Never use the ApiKey query parameter and the Authorization header at the same time.

## How to use AuthWithMetaData

```dart
final metaData = JellyFinClientData(....);

final accessToken = "....."; // can be retried using the UsersApi().

final auth = AuthWithMetadata(accessToken: accessToken, data: metaData);

// create a authenticated client, now you can access all authenticated routes, using this client
final authenticatedClient = ApiClient(host: 'http://localhost:8096', auth);
```

Data class - all properties are used exactly as defined above

```dart
class JellyFinClientData {
  final String? client;
  final String? version;
  final String? deviceId;
  final String? device;

  JellyFinClientData({
    this.client,
    this.version,
    this.deviceId,
    this.device,
  });
}
```

